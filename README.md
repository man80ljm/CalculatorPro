# CalculatorPro

一个基于 PyQt6 的课程目标达成度计算与报告生成工具，支持“正向计算”与“逆向推分”两种模式，并可生成 Excel/Word 报表与 AI 分析报告。

## 功能概览

- 正向模式：导入“正向模板”成绩，计算课程目标达成度并输出明细与统计。
- 逆向模式：导入“逆向模板”总分，按分布/噪声参数反推方法级分数并输出明细与统计。
- 统计与报告：生成表2（课程成绩统计）、表5（达成度评价结果）、表6（AI 改进报告）及最终拼接报告。
- 支持分数跨度、分布模式、噪声注入配置。

## 环境要求

- Python 3.10+
- Windows（推荐）

## 依赖安装

```bash
pip install -r requirements.txt
```

如需使用镜像：

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

## 使用步骤

### 1) 先配置“课程考核与课程目标对应关系”
- 打开“课程考核与课程目标对应关系”并设置目标数、考核环节与方法。

### 2) 正向模式（导入方法级成绩）
1. 选择“正向模式”
2. 点击“模板下载”，生成正向模板
3. 填入学生成绩并保存
4. 点击“导入文件”选择该模板
5. 点击“导出结果”生成报表

### 3) 逆向模式（导入环节总分）
1. 选择“逆向模式”
2. 点击“模板下载”（必须先完成关系表设置）
3. 填入环节总分并保存
4. 点击“导入文件”选择该模板
5. 选择分数跨度 / 分布模式 / 噪声注入
6. 点击“导出结果”生成报表

### 4) 生成 AI 报告（表6）
- 在“设置”中填写 API Key
- 点击“生成报告”

## 输出文件说明（outputs 目录）

正向模式：
- `{课程名}成绩明细.xlsx`（成绩明细 + 课程成绩统计 + 达成度评价结果）
- `2.课程成绩统计表.docx`
- `5.基于考核结果的课程目标达成情况评价结果表.docx`
- `6.课程目标达成情况分析、存在问题及改进措施表.docx`
- 最终拼接报告（基于 `report_template.docx`）

逆向模式：
- `{课程名}成绩明细（逆向）.xlsx`（成绩明细 + 课程成绩统计 + 达成度评价结果）
- `{课程名}正向成绩表（逆向生成）.xlsx`
- `{课程名}课程目标达成情况评价结果（逆向）.xlsx`
- `2.课程成绩统计表.docx`
- `5.基于考核结果的课程目标达成情况评价结果表.docx`
- `6.课程目标达成情况分析、存在问题及改进措施表.docx`
- 最终拼接报告（基于 `report_template.docx`）

## 打包为 EXE（PyInstaller）

在项目根目录执行：

```bash
pyinstaller -F -w \
  --icon=calculator.ico \
  --add-data "calculator.ico;." \
  --add-data "report_template.docx;." \
  main.py
```

说明：
- `-F` 打包为单文件
- `-w` 去掉控制台
- 必须带入 `calculator.ico` 与 `report_template.docx`

## 常见问题

- 模板导入提示不匹配：确认当前模式与模板类型一致。
- 逆向模板下载失败：请先完成“课程考核与课程目标对应关系”设置。
- 文件被占用：关闭已打开的 Excel/Word 文件后重试。